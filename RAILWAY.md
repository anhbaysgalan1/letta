# Deploying Letta on Railway

This guide explains how to deploy Letta on Railway, including PostgreSQL with pgvector extensions and PgAdmin for database management.

## Deployment Options

You have two options for deploying Letta on Railway:

### Option 1: Use the Official Letta Template (Recommended)

The simplest way to deploy Letta is to use the official Railway template:

1. Go to https://railway.com/template/jgUR1t?referralCode=kdR8zc
2. Click "Deploy Now"
3. Fill in the required environment variables

The official template provides:
- Latest Letta Docker image
- PostgreSQL database with pgvector
- Pre-configured environment variables

### Option 2: Custom Deployment (Advanced)

If you need a custom setup with PgAdmin and more control over the configuration, follow the steps below.

## Prerequisites

1. A [Railway account](https://railway.app)
2. Railway CLI installed (`npm i -g @railway/cli`)
3. Git repository for your Letta project

## Custom Deployment Steps

### 1. Login to Railway CLI

```bash
railway login
```

### 2. Initialize Railway Project

```bash
# Create a new project
railway init

# Or link to an existing project
railway link
```

### 3. Deploy the Project

When you run the deployment command, Railway will prompt you for required variables:

```bash
railway up
```

You'll be asked to provide the following information:
- **PostgreSQL Username**: Database user (default: letta)
- **PostgreSQL Password**: Secure password for database access
- **PostgreSQL Database Name**: Name of the database (default: letta)
- **PgAdmin Email**: Email for PgAdmin login
- **PgAdmin Password**: Password for PgAdmin login
- **API Keys**: Various API keys for LLM providers (OpenAI, Anthropic, Azure, etc.)

These values will be securely stored in Railway's environment and used during deployment.

This will deploy the following services:
- **letta_db**: PostgreSQL with pgvector extensions
- **pgadmin**: Web interface for PostgreSQL management
- **letta_server**: The main Letta application
- **letta_nginx**: Nginx for routing requests

### 4. Managing Environment Variables

After initial deployment, you can manage these variables in the Railway dashboard:

1. Go to your project in the Railway dashboard
2. Navigate to the "Variables" tab
3. Edit, add, or remove environment variables as needed
4. Changes to variables will trigger a redeployment

## Supported LLM Providers

Letta supports multiple LLM providers. You can configure one or more of the following:

1. **OpenAI**: Set `OPENAI_API_KEY`
2. **Anthropic**: Set `ANTHROPIC_API_KEY`
3. **Groq**: Set `GROQ_API_KEY`
4. **Azure OpenAI**: Set `AZURE_API_KEY`, `AZURE_BASE_URL`, and `AZURE_API_VERSION`
5. **Google Gemini**: Set `GEMINI_API_KEY`
6. **Composio**: Set `COMPOSIO_API_KEY` for access to 7k+ pre-made tools

For more details on available providers, see the [Letta documentation](https://docs.letta.com/guides/server/docker).

## Public and Private Domains

The Railway deployment exposes both public and private domains for your services:

### Public Domains

Each service is assigned a unique public domain that allows external access:

1. **Letta Server**: Accessible at `https://<your-project-name>.railway.app`
   - Primary HTTP port: 8083
   - WebSocket port: 8283

2. **PgAdmin**: Accessible at a separate Railway-generated domain
   - Used for database management through a web interface

3. **PostgreSQL**: Can be configured to allow external access (optional)
   - Useful for connecting from your local development environment

These public domains are automatically generated by Railway and can be found in your project dashboard.

### Private Domains

Services can also communicate securely within Railway using private domains:

1. **PostgreSQL**: Available internally at `pg-db.railway.internal:5432`
   - Used by the Letta server to connect to the database
   - Not exposed to the public internet by default

2. **Service-to-service communication**: Uses Railway's internal networking

## Accessing Services

### PostgreSQL

The PostgreSQL database is accessible:
- **From within Railway**: Use the private domain `pg-db.railway.internal:5432`
- **From outside Railway**: Use the public URL from Railway dashboard
- **Connection string**: `postgresql://letta:your_password@hostname:port/letta`

### PgAdmin

Access PgAdmin through the public URL provided in the Railway dashboard:
1. Login with your configured email and password
2. Add a new server connection:
   - Host: `pg-db.railway.internal` (when using inside Railway) or the Railway provided PostgreSQL URL (when external)
   - Port: `5432`
   - Username: `letta` (or your configured LETTA_PG_USER)
   - Password: Your configured LETTA_PG_PASSWORD

### Letta Application

The main application is accessible through the Railway-provided public domain at:
- HTTP API: `https://<your-project>.railway.app:8083`
- WebSocket: `wss://<your-project>.railway.app:8283`

For a tutorial on how to use the deployed Letta server:
1. Go to [https://app.letta.com](https://app.letta.com)
2. Connect to your remote development server using the Railway-provided URL
3. Enter the password you configured during deployment

## Private Network Configuration

Railway provides private networking between services within the same project. This allows your services to communicate securely without exposing internal endpoints to the public internet.

### How It Works

- Each service gets a private domain name automatically assigned
- Services can reference each other using their private domains
- In our configuration, the database can be accessed by other services using its private domain

### Verifying Private Network Setup

To verify that private networking is properly configured:

1. Check the Railway dashboard for each service
2. Look for the "Private Networking" section
3. Ensure that the database service shows "EXPOSED" for port 5432
4. Confirm that the server service shows the proper "DEPENDENCIES" pointing to the database

## Monitoring and Logs

View logs and monitor your application:

```bash
railway logs
```

## Updating Your Deployment

After making changes to your code:

```bash
git add .
git commit -m "Update application"
git push

# Deploy the updates
railway up
```

## Troubleshooting

### "Failed to get private network endpoint" Error

If you encounter this error:

1. **Check service naming**: Ensure service names in `.railway.yaml` match those in `railway-compose.yaml`
2. **Verify exposures**: Make sure the database service properly exposes port 5432
3. **Service dependencies**: Confirm that service dependencies are correctly defined
4. **Restart deployment**: Sometimes simply redeploying can fix networking issues:
   ```bash
   railway down
   railway up
   ```
5. **Use explicit domains**: In Railway dashboard, copy the private domain of your database service and manually set it in environment variables

### Other Common Issues

- **Database Connection Issues**: Verify PostgreSQL credentials and check if the service is running
- **PgAdmin Access Problems**: Confirm PgAdmin environment variables are set correctly
- **Application Errors**: Check application logs with `railway logs`

## Resources

- [Official Letta Documentation](https://docs.letta.com)
- [Letta Railway Deployment Guide](https://docs.letta.com/guides/server/railway)
- [Letta GitHub Repository](https://github.com/letta-ai/letta) 